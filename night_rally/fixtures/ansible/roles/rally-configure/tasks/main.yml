---

- name: install Rally config file
  become: "{{ not local_setup | default() | bool }}"
  become_user: "jenkins"
  template:
    src: rally.ini.j2
    dest: "{{ rally_homedir }}/.rally/rally-{{ rally_environment }}.ini"

- block:
    - set_fact:
        gcs_service_account_contents: "{{ lookup('hashi_vault', 'secret=/secret/ci/elastic-night-rally/employees/cloud/buckets/gcs/performance-rally-internal:service_account') }}"

    - name: write gcs service account file
      become: true
      become_user: "jenkins"
      copy:
        content: "{{ gcs_service_account_contents }}"
        dest: ~/.gcs-service-account.json
  when: not local_setup | default("false") | bool
