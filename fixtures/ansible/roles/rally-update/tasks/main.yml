---

- name: stop rallyd
  command: ./rallyd stop
  args:
    chdir: /var/lib/jenkins/bin
  become: true
  become_user: jenkins
  ignore_errors: true

- name: ensure all rally daemon processes have been killed
  command: killall -9 esrallyd
  ignore_errors: true
  become: true

- name: install Rally config file
  become: true
  template:
    src: rally.ini.j2
    dest: /var/lib/jenkins/.rally/rally-{{ rally_environment }}.ini


- name: start rallyd
  command: ./rallyd start --node-ip {{ inventory_hostname }} --coordinator-ip {{ groups['elasticsearch-ci-slaves-macrobenchmarks'][0] }}
  args:
    chdir: /var/lib/jenkins/bin
  become: true
  become_user: jenkins
